<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Course &amp; Lesson Management</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Comfortaa:wght@400;700&amp;family=Montserrat:wght@400;600;700&amp;display=swap" rel="stylesheet">
    <style>
        :root {
            --accent-dark: #7c011d;
            --accent-light: #f8cdd4;
            --accent-medium: #dd4f68;
            --bg: #fff3f6;
            --text: #3a1a27;
            --shadow: rgba(124, 1, 29, 0.15);
        }

        * {
            box-sizing: border-box;
        }

        body {
            margin: 0;
            font-family: 'Montserrat', 'Comfortaa', sans-serif;
            background: var(--bg);
            color: var(--text);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        header {
            background: linear-gradient(180deg, #ff627a 0%, #ff3d5f 100%);
            padding: 1.5rem 1rem 2.5rem;
            position: relative;
            box-shadow: 0 8px 20px rgba(255, 61, 95, 0.3);
        }

        header::after {
            content: '';
            position: absolute;
            left: 50%;
            transform: translateX(-50%);
            bottom: -36px;
            width: 260px;
            height: 72px;
            background:
                radial-gradient(circle at 20% 50%, rgba(255, 255, 255, 0.85) 0 16%, transparent 18%),
                radial-gradient(circle at 40% 40%, rgba(255, 255, 255, 0.75) 0 16%, transparent 18%),
                radial-gradient(circle at 60% 60%, rgba(255, 255, 255, 0.7) 0 16%, transparent 18%),
                radial-gradient(circle at 80% 45%, rgba(255, 255, 255, 0.8) 0 16%, transparent 18%),
                linear-gradient(180deg, rgba(255, 170, 186, 0.7), rgba(255, 118, 152, 0.85));
            border-radius: 40px;
            pointer-events: none;
        }

        .page-title {
            text-align: center;
            color: #fff;
            margin: 0;
            font-size: 1.75rem;
            letter-spacing: 0.08em;
            text-transform: uppercase;
        }

        .level-tabs {
            margin: 1.5rem auto 0;
            display: flex;
            justify-content: center;
            gap: 0.75rem;
            flex-wrap: wrap;
            position: relative;
            z-index: 1;
        }

        .level-tab {
            border: none;
            border-radius: 50px;
            padding: 0.65rem 1.85rem;
            font-size: 1rem;
            font-weight: 700;
            background: rgba(255, 255, 255, 0.75);
            color: var(--accent-dark);
            cursor: pointer;
            transition: transform 0.2s ease, box-shadow 0.2s ease, background 0.2s ease;
        }

        .level-tab:focus-visible {
            outline: 3px solid rgba(255, 255, 255, 0.8);
            outline-offset: 2px;
        }

        .level-tab.is-active {
            background: #fff;
            transform: translateY(-4px);
            box-shadow: 0 6px 18px rgba(124, 1, 29, 0.25);
        }

        main {
            padding: 6rem 1rem 3rem;
            width: min(1080px, 100%);
            margin: 0 auto;
        }

        .course-heading {
            text-align: center;
            margin-bottom: 1rem;
        }

        .course-heading h2 {
            margin: 0;
            font-size: 1.5rem;
            color: var(--accent-dark);
        }

        .course-heading p {
            margin: 0.35rem 0 0;
            color: rgba(58, 26, 39, 0.7);
        }

        .lessons-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
            gap: 1.5rem;
            padding: 1rem 0 2rem;
        }

        .lesson-card {
            background: var(--accent-light);
            border-radius: 28px;
            padding: 1.75rem 0.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
            flex-direction: column;
            box-shadow: 0 12px 24px var(--shadow);
            position: relative;
            overflow: hidden;
        }

        .lesson-card::before {
            content: '';
            position: absolute;
            inset: 12px;
            border-radius: 20px;
            background: rgba(255, 255, 255, 0.35);
            z-index: 0;
        }

        .lesson-number {
            position: relative;
            z-index: 1;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            min-width: 80px;
            padding: 0.4rem 1rem;
            border-radius: 999px;
            background: var(--accent-dark);
            color: #fff;
            font-weight: 700;
            letter-spacing: 0.05em;
            margin-bottom: 0.6rem;
        }

        .lesson-title {
            position: relative;
            z-index: 1;
            font-size: 0.95rem;
            line-height: 1.4;
            padding: 0 1rem;
        }

        .status-message {
            text-align: center;
            color: rgba(58, 26, 39, 0.6);
            font-style: italic;
        }

        @media (max-width: 600px) {
            header::after {
                bottom: -28px;
                width: 200px;
            }

            .level-tab {
                padding: 0.55rem 1.5rem;
                font-size: 0.9rem;
            }

            main {
                padding-top: 5.5rem;
            }
        }
    </style>
</head>
<body>
    <header>
        <h1 class="page-title">JLPT Course Manager</h1>
        <nav class="level-tabs" aria-label="JLPT level selector"></nav>
    </header>
    <main>
        <div class="course-heading" aria-live="polite">
            <h2 id="courseTitle">Select a level</h2>
            <p id="courseDescription"></p>
        </div>
        <p class="status-message" id="statusMessage">Loading courses&hellip;</p>
        <section class="lessons-grid" id="lessonsGrid" aria-live="polite"></section>
    </main>

    <template id="lessonCardTemplate">
        <article class="lesson-card">
            <span class="lesson-number"></span>
            <span class="lesson-title"></span>
        </article>
    </template>

    <script>
        const levelTabsContainer = document.querySelector('.level-tabs');
        const lessonsGrid = document.getElementById('lessonsGrid');
        const courseTitle = document.getElementById('courseTitle');
        const courseDescription = document.getElementById('courseDescription');
        const statusMessage = document.getElementById('statusMessage');
        const lessonCardTemplate = document.getElementById('lessonCardTemplate');

        const sampleCourses = [
            {
                levelCode: 'N5',
                name: 'JLPT N5',
                description: 'Foundational Japanese for absolute beginners.',
                lessons: [
                    { lessonNumber: 1, title: 'Lesson 1: Hiragana Basics' },
                    { lessonNumber: 2, title: 'Lesson 2: Greetings and Introductions' },
                    { lessonNumber: 3, title: 'Lesson 3: Daily Activities Vocabulary' },
                    { lessonNumber: 4, title: 'Lesson 4: Numbers and Counters' },
                    { lessonNumber: 5, title: 'Lesson 5: Basic Sentence Structure' },
                    { lessonNumber: 6, title: 'Lesson 6: Family and Relationships' },
                    { lessonNumber: 7, title: 'Lesson 7: Time Expressions' },
                    { lessonNumber: 8, title: 'Lesson 8: Adjectives and Descriptions' },
                    { lessonNumber: 9, title: 'Lesson 9: Asking Questions' },
                    { lessonNumber: 10, title: 'Lesson 10: Shopping Phrases' },
                    { lessonNumber: 11, title: 'Lesson 11: Verb Te-form Basics' },
                    { lessonNumber: 12, title: 'Lesson 12: Locations and Directions' },
                    { lessonNumber: 13, title: 'Lesson 13: Particles Review' },
                    { lessonNumber: 14, title: 'Lesson 14: Likes and Dislikes' },
                    { lessonNumber: 15, title: 'Lesson 15: Weather and Seasons' },
                    { lessonNumber: 16, title: 'Lesson 16: Verb Past Tense' },
                    { lessonNumber: 17, title: 'Lesson 17: Invitations and Plans' },
                    { lessonNumber: 18, title: 'Lesson 18: Transportation Vocabulary' },
                    { lessonNumber: 19, title: 'Lesson 19: Restaurant Conversations' },
                    { lessonNumber: 20, title: 'Lesson 20: Giving Reasons with kara' },
                    { lessonNumber: 21, title: 'Lesson 21: Verb Potential Form' },
                    { lessonNumber: 22, title: 'Lesson 22: Invitations with mashou' },
                    { lessonNumber: 23, title: 'Lesson 23: Requests with kudasai' },
                    { lessonNumber: 24, title: 'Lesson 24: Comparisons with yori' },
                    { lessonNumber: 25, title: 'Lesson 25: Review and Practice' }
                ]
            },
            {
                levelCode: 'N4',
                name: 'JLPT N4',
                description: 'Lower-intermediate Japanese grammar and vocabulary.',
                lessons: [
                    { lessonNumber: 1, title: 'Lesson 1: Keigo Essentials' },
                    { lessonNumber: 2, title: 'Lesson 2: Complex Sentence Patterns' },
                    { lessonNumber: 3, title: 'Lesson 3: Verb Te-iru Nuances' },
                    { lessonNumber: 4, title: 'Lesson 4: Expressing Obligation' },
                    { lessonNumber: 5, title: 'Lesson 5: Expressing Ability and Permission' },
                    { lessonNumber: 6, title: 'Lesson 6: Wishes and Intentions' },
                    { lessonNumber: 7, title: 'Lesson 7: Giving and Receiving Verbs' },
                    { lessonNumber: 8, title: 'Lesson 8: Expressing Experience' },
                    { lessonNumber: 9, title: 'Lesson 9: Conditional Forms' },
                    { lessonNumber: 10, title: 'Lesson 10: Casual Speech Patterns' },
                    { lessonNumber: 11, title: 'Lesson 11: Expressing Purpose' },
                    { lessonNumber: 12, title: 'Lesson 12: Transitive vs. Intransitive Verbs' },
                    { lessonNumber: 13, title: 'Lesson 13: Describing Preparations' },
                    { lessonNumber: 14, title: 'Lesson 14: Expressing Hearsay' },
                    { lessonNumber: 15, title: 'Lesson 15: Expressing Attempts' },
                    { lessonNumber: 16, title: 'Lesson 16: Passive Voice Introduction' },
                    { lessonNumber: 17, title: 'Lesson 17: Causative Basics' },
                    { lessonNumber: 18, title: 'Lesson 18: Expressing Excess' },
                    { lessonNumber: 19, title: 'Lesson 19: Expressing While Doing' },
                    { lessonNumber: 20, title: 'Lesson 20: Review and Practice' }
                ]
            },
            {
                levelCode: 'N3',
                name: 'JLPT N3',
                description: 'Bridge level with intermediate grammar patterns.',
                lessons: [
                    { lessonNumber: 1, title: 'Lesson 1: Nuanced Particles' },
                    { lessonNumber: 2, title: 'Lesson 2: Advanced Te-form Uses' },
                    { lessonNumber: 3, title: 'Lesson 3: Expressing Concessions' },
                    { lessonNumber: 4, title: 'Lesson 4: Emphasis Structures' },
                    { lessonNumber: 5, title: 'Lesson 5: Expressing Probability' },
                    { lessonNumber: 6, title: 'Lesson 6: Passive Causative Review' },
                    { lessonNumber: 7, title: 'Lesson 7: Formal Expressions' },
                    { lessonNumber: 8, title: 'Lesson 8: Relative Clauses' },
                    { lessonNumber: 9, title: 'Lesson 9: Expressing Intentions' },
                    { lessonNumber: 10, title: 'Lesson 10: Idiomatic Expressions' },
                    { lessonNumber: 11, title: 'Lesson 11: Written Japanese Styles' },
                    { lessonNumber: 12, title: 'Lesson 12: Expressing Gradual Change' },
                    { lessonNumber: 13, title: 'Lesson 13: Hypothetical Expressions' },
                    { lessonNumber: 14, title: 'Lesson 14: Expressing Emotions' },
                    { lessonNumber: 15, title: 'Lesson 15: Review and Practice' }
                ]
            },
            {
                levelCode: 'N2',
                name: 'JLPT N2',
                description: 'Upper-intermediate Japanese for academic and professional contexts.',
                lessons: [
                    { lessonNumber: 1, title: 'Lesson 1: Academic Reading Strategies' },
                    { lessonNumber: 2, title: 'Lesson 2: Nuanced Conditionals' },
                    { lessonNumber: 3, title: 'Lesson 3: Formal Written Expressions' },
                    { lessonNumber: 4, title: 'Lesson 4: Advanced Honorifics' },
                    { lessonNumber: 5, title: 'Lesson 5: Expressing Criticism' },
                    { lessonNumber: 6, title: 'Lesson 6: Emphatic Structures' },
                    { lessonNumber: 7, title: 'Lesson 7: Academic Vocabulary' },
                    { lessonNumber: 8, title: 'Lesson 8: Expressing Simultaneity' },
                    { lessonNumber: 9, title: 'Lesson 9: Persuasive Writing' },
                    { lessonNumber: 10, title: 'Lesson 10: Review and Practice' }
                ]
            },
            {
                levelCode: 'N1',
                name: 'JLPT N1',
                description: 'Advanced Japanese with native-level comprehension.',
                lessons: [
                    { lessonNumber: 1, title: 'Lesson 1: Advanced Reading Comprehension' },
                    { lessonNumber: 2, title: 'Lesson 2: Nuanced Vocabulary' },
                    { lessonNumber: 3, title: 'Lesson 3: Hypothetical Discourse' },
                    { lessonNumber: 4, title: 'Lesson 4: Expressing Contradiction' },
                    { lessonNumber: 5, title: 'Lesson 5: Formal Speechcraft' },
                    { lessonNumber: 6, title: 'Lesson 6: Academic Listening Practice' },
                    { lessonNumber: 7, title: 'Lesson 7: Expressing Nuanced Emotions' },
                    { lessonNumber: 8, title: 'Lesson 8: Review and Practice' }
                ]
            }
        ];

        const useMockData = new URLSearchParams(window.location.search).get('mock') === 'true';

        let courses = [];
        let activeLevel = '';

        function setActiveLevel(levelCode) {
            activeLevel = levelCode;
            document.querySelectorAll('.level-tab').forEach(button => {
                button.classList.toggle('is-active', button.dataset.level === levelCode);
            });
        }

        function renderLessons(course) {
            lessonsGrid.innerHTML = '';

            if (!course || !course.lessons || !course.lessons.length) {
                statusMessage.textContent = 'No lessons found for this level yet.';
                statusMessage.hidden = false;
                return;
            }

            statusMessage.hidden = true;

            course.lessons.forEach(lesson => {
                const card = lessonCardTemplate.content.firstElementChild.cloneNode(true);
                card.querySelector('.lesson-number').textContent = `Lesson ${lesson.lessonNumber}`;
                card.querySelector('.lesson-title').textContent = lesson.title;
                lessonsGrid.appendChild(card);
            });
        }

        function renderCourse(course) {
            if (!course) {
                courseTitle.textContent = 'Select a level';
                courseDescription.textContent = '';
                lessonsGrid.innerHTML = '';
                statusMessage.hidden = false;
                return;
            }

            courseTitle.textContent = `${course.levelCode} Â· ${course.name}`;
            courseDescription.textContent = course.description || '';
            renderLessons(course);
        }

        function handleLevelSelection(course) {
            if (!course) return;
            setActiveLevel(course.levelCode);
            renderCourse(course);
        }

        function buildLevelTabs() {
            levelTabsContainer.innerHTML = '';
            courses.forEach((course, index) => {
                const button = document.createElement('button');
                button.type = 'button';
                button.className = 'level-tab';
                button.dataset.level = course.levelCode;
                button.textContent = course.levelCode;
                button.addEventListener('click', () => handleLevelSelection(course));
                levelTabsContainer.appendChild(button);
                if (index === 0) {
                    handleLevelSelection(course);
                }
            });

            if (!courses.length) {
                statusMessage.textContent = 'No courses found. Please seed the database.';
                statusMessage.hidden = false;
            } else {
                statusMessage.hidden = true;
            }
        }

        async function loadCourses() {
            try {
                const response = await fetch('/api/courses');
                if (!response.ok) {
                    throw new Error(`Request failed with status ${response.status}`);
                }

                courses = await response.json();
                buildLevelTabs();
            } catch (error) {
                console.error('Failed to load courses', error);
                statusMessage.textContent = 'Unable to load courses right now. Please try again later.';
                statusMessage.hidden = false;
            }
        }

        if (useMockData) {
            courses = sampleCourses;
            buildLevelTabs();
        } else {
            loadCourses();
        }
    </script>
</body>
</html>
